<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë™ì  ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
      color: #fff;
      min-height: 100vh;
      padding: 40px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      color: #ffd700;
    }

    .test-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .test-section h2 {
      margin-bottom: 20px;
      color: #4ecdc4;
    }

    .test-description {
      color: #aaa;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .test-btn {
      display: inline-block;
      padding: 15px 30px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-warning {
      background: linear-gradient(135deg, #f093fb, #f5576c);
      color: #fff;
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(245, 87, 108, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #11998e, #38ef7d);
      color: #fff;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(56, 239, 125, 0.4);
    }

    .status {
      margin-top: 20px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.9rem;
    }

    .status-label {
      color: #888;
      margin-bottom: 5px;
    }

    .status-value {
      color: #4ecdc4;
    }

    .team-scores {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .team-score {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .team-score .name {
      font-weight: 600;
      color: #ffd700;
      margin-bottom: 5px;
    }

    .team-score .amount {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .back-link {
      display: inline-block;
      margin-top: 30px;
      color: #667eea;
      text-decoration: none;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .note {
      background: rgba(255, 215, 0, 0.1);
      border-left: 4px solid #ffd700;
      padding: 15px;
      margin-top: 20px;
      border-radius: 0 8px 8px 0;
    }

    .note strong {
      color: #ffd700;
    }
  </style>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ ë™ì  ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h1>

    <div class="test-section">
      <h2>1. ì™„ì „ ë™ì  (ë°•ë¹™ì˜ ìŠ¹ë¶€)</h2>
      <p class="test-description">
        1ìœ„ì™€ 2ìœ„ê°€ ì™„ì „íˆ ê°™ì€ íˆ¬ìê¸ˆì„ ë°›ì€ ê²½ìš°ì…ë‹ˆë‹¤.<br>
        "ë°•ë¹™ì˜ ìŠ¹ë¶€" í™”ë©´ì´ í‘œì‹œë˜ë©°, 3ìœ„ì™€ 4ìœ„ì˜ í‰ê°€ë¡œ ìµœì¢… 1ìœ„ë¥¼ ê°€ë¦°ë‹¤ëŠ” ì•ˆë‚´ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
      </p>
      <button class="test-btn btn-warning" onclick="setTieScenario()">ë™ì  ë°ì´í„° ì„¤ì •</button>
      <button class="test-btn btn-primary" onclick="goToMain()">ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™</button>

      <div class="note">
        <strong>í…ŒìŠ¤íŠ¸ ë°©ë²•:</strong><br>
        1. "ë™ì  ë°ì´í„° ì„¤ì •" í´ë¦­<br>
        2. "ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™" í´ë¦­<br>
        3. MC ì»¨íŠ¸ë¡¤ì—ì„œ "ë°œí‘œ ì‹œì‘" í´ë¦­<br>
        4. ë‹¤ìŒ ë‹¨ê³„ë¥¼ ëˆŒëŸ¬ Step 4 (ë°ë“œíˆíŠ¸)ê¹Œì§€ ì§„í–‰
      </div>
    </div>

    <div class="test-section">
      <h2>2. ì¼ë°˜ ë°ë“œíˆíŠ¸ (ì°¨ì´ ìˆìŒ)</h2>
      <p class="test-description">
        1ìœ„ê°€ 2ìœ„ë³´ë‹¤ íˆ¬ìê¸ˆì„ ë” ë§ì´ ë°›ì€ ì¼ë°˜ì ì¸ ê²½ìš°ì…ë‹ˆë‹¤.<br>
        "ë§ˆì§€ë§‰ íˆ¬ìê¸ˆì˜ í–¥ë°©ì€?" ë°ë“œíˆíŠ¸ í™”ë©´ì´ í‘œì‹œë©ë‹ˆë‹¤.
      </p>
      <button class="test-btn btn-success" onclick="setNormalScenario()">ì¼ë°˜ ë°ì´í„° ì„¤ì •</button>
      <button class="test-btn btn-primary" onclick="goToMain()">ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™</button>
    </div>

    <div class="test-section">
      <h2>í˜„ì¬ ì„œë²„ ìƒíƒœ</h2>
      <div class="status">
        <div class="status-label">Phase:</div>
        <div class="status-value" id="current-phase">-</div>
      </div>
      <div class="status">
        <div class="status-label">Presentation Step:</div>
        <div class="status-value" id="current-step">-</div>
      </div>
      <div class="team-scores" id="team-scores">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
      </div>
      <button class="test-btn btn-primary" onclick="refreshStatus()" style="margin-top: 20px;">ìƒíƒœ ìƒˆë¡œê³ ì¹¨</button>
      <button class="test-btn btn-warning" onclick="resetSystem()">ì‹œìŠ¤í…œ ë¦¬ì…‹</button>
    </div>

    <a href="/main" class="back-link">â† ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>

  <script>
    const socket = io({
      transports: ['polling', 'websocket'],
      reconnectionDelay: 1000,
      reconnectionDelayMax: 5000,
      timeout: 20000
    });

    let currentState = null;

    socket.on('connect', () => {
      console.log('Connected to server');
      socket.emit('admin:join');
    });

    socket.on('state:update', (state) => {
      currentState = state;
      updateStatusDisplay(state);
    });

    function updateStatusDisplay(state) {
      document.getElementById('current-phase').textContent = state.phase;
      document.getElementById('current-step').textContent = state.presentationStep;

      const scoresContainer = document.getElementById('team-scores');
      // ë°œí‘œ ìˆœì„œëŒ€ë¡œ ì •ë ¬
      const orderedTeams = state.presentationOrder
        ? state.presentationOrder.map(id => state.teams.find(t => t.id === id))
        : state.teams;

      scoresContainer.innerHTML = orderedTeams.map(team => `
        <div class="team-score">
          <div class="name">${team.name}</div>
          <div class="amount">${team.totalInvestment}ì–µì›</div>
        </div>
      `).join('');
    }

    function setTieScenario() {
      // 1ìœ„ì™€ 2ìœ„ê°€ ë™ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ (ì˜ˆ: ë‘˜ ë‹¤ 15ì–µì›)
      socket.emit('test:setScores', {
        scores: {
          1: 12,  // 1ì¡°
          2: 15,  // 2ì¡°
          3: 15,  // 3ì¡°
          4: 8    // 4ì¡°
        }
      });
      alert('ë™ì  ì‹œë‚˜ë¦¬ì˜¤ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në°œí‘œ ìˆœì„œ(2ì¡°â†’4ì¡°â†’3ì¡°â†’1ì¡°) ê¸°ì¤€ìœ¼ë¡œ:\n- 1ìœ„: 2ì¡°, 3ì¡° (15ì–µì› ë™ì )\n- 3ìœ„: 1ì¡° (12ì–µì›)\n- 4ìœ„: 4ì¡° (8ì–µì›)\n\në©”ì¸ í™”ë©´ì—ì„œ ë°œí‘œë¥¼ ì§„í–‰í•´ë³´ì„¸ìš”.');
    }

    function setNormalScenario() {
      // ì¼ë°˜ ì‹œë‚˜ë¦¬ì˜¤ (1ìœ„ê°€ 2ìœ„ë³´ë‹¤ ë†’ìŒ)
      socket.emit('test:setScores', {
        scores: {
          1: 10,  // 1ì¡°
          2: 18,  // 2ì¡°
          3: 14,  // 3ì¡°
          4: 8    // 4ì¡°
        }
      });
      alert('ì¼ë°˜ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në°œí‘œ ìˆœì„œ(2ì¡°â†’4ì¡°â†’3ì¡°â†’1ì¡°) ê¸°ì¤€ìœ¼ë¡œ:\n- 1ìœ„: 2ì¡° (18ì–µì›)\n- 2ìœ„: 3ì¡° (14ì–µì›)\n- 3ìœ„: 1ì¡° (10ì–µì›)\n- 4ìœ„: 4ì¡° (8ì–µì›)\n\në©”ì¸ í™”ë©´ì—ì„œ ë°œí‘œë¥¼ ì§„í–‰í•´ë³´ì„¸ìš”.');
    }

    function goToMain() {
      window.location.href = '/main';
    }

    function refreshStatus() {
      socket.emit('admin:join');
    }

    function resetSystem() {
      if (confirm('ì‹œìŠ¤í…œì„ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        socket.emit('admin:reset');
        setTimeout(() => {
          alert('ì‹œìŠ¤í…œì´ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤.');
          refreshStatus();
        }, 500);
      }
    }
  </script>
</body>
</html>
