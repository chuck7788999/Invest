<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì íŒ¨ë„ - kt cloud íˆ¬ì í‰ê°€</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #1a1a2e;
      min-height: 100vh;
      color: #fff;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 30px;
      background: linear-gradient(90deg, #ffd700, #ff6b35);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 25px;
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* ìƒíƒœ íŒ¨ë„ */
    .status-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .status-item {
      text-align: center;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
    }

    .status-value {
      font-size: 2.5rem;
      font-weight: 900;
      color: #ffd700;
    }

    .status-label {
      font-size: 0.85rem;
      color: #888;
      margin-top: 5px;
    }

    .phase-badge {
      display: inline-block;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.9rem;
    }

    .phase-waiting { background: #3498db; }
    .phase-evaluating { background: #f39c12; }
    .phase-results { background: #27ae60; }
    .phase-presenting { background: #e74c3c; }

    /* ë²„íŠ¼ */
    .btn {
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ffd700, #ff6b35);
      color: #000;
    }

    .btn-success {
      background: #27ae60;
      color: #fff;
    }

    .btn-danger {
      background: #e74c3c;
      color: #fff;
    }

    .btn-secondary {
      background: #3498db;
      color: #fff;
    }

    .btn-warning {
      background: #f39c12;
      color: #000;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    /* í‰ê°€ì ëª©ë¡ */
    .evaluator-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .evaluator-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      margin-bottom: 8px;
    }

    .evaluator-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .evaluator-status {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .evaluator-status.connected { background: #27ae60; }
    .evaluator-status.disconnected { background: #e74c3c; }
    .evaluator-status.evaluated { background: #3498db; }

    .evaluator-name {
      font-weight: 500;
    }

    .evaluator-badge {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 10px;
      background: rgba(255, 215, 0, 0.2);
      color: #ffd700;
    }

    /* íŒ€ ì„¤ì • */
    .team-config {
      margin-bottom: 15px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }

    .team-config-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .team-number {
      background: linear-gradient(135deg, #ffd700, #ff6b35);
      color: #000;
      padding: 4px 12px;
      border-radius: 15px;
      font-weight: 700;
      font-size: 0.85rem;
    }

    .team-investment {
      margin-left: auto;
      font-size: 1.1rem;
      font-weight: 700;
      color: #ffd700;
    }

    .team-input {
      width: 100%;
      padding: 10px;
      font-size: 0.9rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      margin-top: 8px;
    }

    /* ë°œí‘œ ì»¨íŠ¸ë¡¤ */
    .presentation-control {
      text-align: center;
      padding: 30px;
    }

    .step-indicator {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
    }

    .step {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      transition: all 0.3s;
    }

    .step.active {
      background: linear-gradient(135deg, #ffd700, #ff6b35);
      color: #000;
      transform: scale(1.2);
    }

    .step.done {
      background: #27ae60;
    }

    .step-label {
      font-size: 1.2rem;
      color: #888;
      margin-bottom: 20px;
    }

    .step-description {
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffd700;
      margin-bottom: 30px;
    }

    /* ì„¤ì • */
    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .setting-label {
      font-weight: 500;
    }

    .setting-input {
      width: 80px;
      padding: 8px;
      font-size: 1rem;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
    }

    /* ê²°ê³¼ ìš”ì•½ */
    .result-item {
      display: flex;
      align-items: center;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      margin-bottom: 10px;
    }

    .result-rank {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 1.2rem;
      margin-right: 15px;
    }

    .result-rank.rank-1 { background: linear-gradient(135deg, #ffd700, #ff6b35); color: #000; }
    .result-rank.rank-2 { background: #c0c0c0; color: #000; }
    .result-rank.rank-3 { background: #cd7f32; color: #000; }
    .result-rank.rank-4 { background: #4a4a4a; color: #fff; }

    .result-info {
      flex: 1;
    }

    .result-team {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .result-amount {
      color: #ffd700;
      font-weight: 700;
      font-size: 1.2rem;
    }

    /* í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì•ˆë‚´ */
    .shortcuts {
      margin-top: 20px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
    }

    .shortcut-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
    }

    .shortcut-key {
      background: rgba(255, 255, 255, 0.1);
      padding: 4px 10px;
      border-radius: 5px;
      font-family: monospace;
    }

    /* ì•Œë¦¼ */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      background: #27ae60;
      color: #fff;
      border-radius: 10px;
      font-weight: 500;
      animation: slideIn 0.3s ease;
      z-index: 1000;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ›ï¸ kt cloud íˆ¬ì í‰ê°€ ê´€ë¦¬ì íŒ¨ë„</h1>

    <div class="grid">
      <!-- ìƒíƒœ íŒ¨ë„ -->
      <div class="card">
        <h2 class="card-title">ğŸ“Š í˜„ì¬ ìƒíƒœ</h2>
        <div class="status-grid">
          <div class="status-item">
            <div class="status-value" id="connected-count">0</div>
            <div class="status-label">ì ‘ì†ì</div>
          </div>
          <div class="status-item">
            <div class="status-value" id="evaluated-count">0</div>
            <div class="status-label">í‰ê°€ ì™„ë£Œ</div>
          </div>
          <div class="status-item">
            <div class="status-value" id="total-evaluators">12</div>
            <div class="status-label">ì „ì²´ í‰ê°€ì</div>
          </div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
          <span class="phase-badge phase-waiting" id="phase-badge">ëŒ€ê¸° ì¤‘</span>
        </div>
        <div class="btn-group" style="justify-content: center;">
          <button class="btn btn-success" id="start-btn" onclick="startEvaluation()">
            â–¶ï¸ í‰ê°€ ì‹œì‘
          </button>
          <button class="btn btn-warning" id="force-close-btn" onclick="forceClose()" style="display:none;">
            âš ï¸ ê°•ì œ ë§ˆê°
          </button>
          <button class="btn btn-primary" id="start-presentation-btn" onclick="startPresentation()" style="display:none;">
            ğŸ¬ ê²°ê³¼ ë°œí‘œ ì‹œì‘
          </button>
        </div>
      </div>

      <!-- í‰ê°€ì ëª©ë¡ -->
      <div class="card">
        <h2 class="card-title">ğŸ‘¥ í‰ê°€ì ëª©ë¡</h2>
        <div class="evaluator-list" id="evaluator-list">
          <div style="text-align: center; color: #888; padding: 40px;">
            ì•„ì§ ì ‘ì†í•œ í‰ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤
          </div>
        </div>
      </div>

      <!-- íŒ€ ì„¤ì • -->
      <div class="card">
        <h2 class="card-title">ğŸ¢ íŒ€ ì„¤ì •</h2>
        <div id="teams-config">
          <!-- ë™ì  ìƒì„± -->
        </div>
        <button class="btn btn-secondary" onclick="updateTeams()" style="margin-top: 15px;">
          ğŸ’¾ íŒ€ ì •ë³´ ì €ì¥
        </button>
      </div>

      <!-- ë°œí‘œ ì»¨íŠ¸ë¡¤ -->
      <div class="card" id="presentation-card" style="display: none;">
        <h2 class="card-title">ğŸ­ ë°œí‘œ ì»¨íŠ¸ë¡¤</h2>
        <div class="presentation-control">
          <div class="step-indicator">
            <div class="step" id="step-1">1</div>
            <div class="step" id="step-2">2</div>
            <div class="step" id="step-3">3</div>
            <div class="step" id="step-4">4</div>
            <div class="step" id="step-5">5</div>
            <div class="step" id="step-6">6</div>
            <div class="step" id="step-7">7</div>
          </div>
          <div class="step-label" id="step-label">ì¤€ë¹„ ì¤‘...</div>
          <div class="step-description" id="step-description">ë°œí‘œë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”</div>
          <button class="btn btn-primary btn-lg" id="next-step-btn" onclick="nextStep()">
            â¡ï¸ ë‹¤ìŒ ë‹¨ê³„
          </button>
        </div>
        <div class="shortcuts">
          <h3 style="margin-bottom: 10px; font-size: 0.9rem;">âŒ¨ï¸ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤</h3>
          <div class="shortcut-item">
            <span>ë‹¤ìŒ ë‹¨ê³„</span>
            <span class="shortcut-key">Space / Enter / â†’</span>
          </div>
        </div>
      </div>

      <!-- ê²°ê³¼ ìš”ì•½ -->
      <div class="card" id="results-card" style="display: none;">
        <h2 class="card-title">ğŸ† ìµœì¢… ê²°ê³¼</h2>
        <div id="results-list">
          <!-- ë™ì  ìƒì„± -->
        </div>
      </div>

      <!-- ì„¤ì • -->
      <div class="card">
        <h2 class="card-title">âš™ï¸ ì„¤ì •</h2>
        <div class="setting-row">
          <span class="setting-label">ì „ì²´ í‰ê°€ì ìˆ˜</span>
          <input type="number" class="setting-input" id="evaluator-count-input"
                 value="12" min="1" max="100" onchange="setEvaluatorCount(this.value)">
        </div>
        <div class="btn-group" style="margin-top: 20px;">
          <button class="btn btn-danger" onclick="resetSystem()">
            ğŸ”„ ì‹œìŠ¤í…œ ë¦¬ì…‹
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const socket = io();
    let currentState = null;

    const stepDescriptions = {
      0: 'ë°œí‘œë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”',
      1: 'ğŸ‰ ì˜¤í”„ë‹ - ëª¨ë“  ë§‰ëŒ€ ìƒìŠ¹',
      2: '4ï¸âƒ£ 4ìœ„ ë°œí‘œ',
      3: '3ï¸âƒ£ 3ìœ„ ë°œí‘œ',
      4: 'ğŸ”¥ 1/2ìœ„ ë°ë“œíˆíŠ¸',
      5: 'ğŸ“Š 1/2ìœ„ ì ìˆ˜ ê³µê°œ',
      6: 'ğŸ‘‘ 1ìœ„ í•˜ì´ë¼ì´íŠ¸',
      7: 'ğŸ† ìµœì¢… ê²°ê³¼'
    };

    // ============ ì´ˆê¸°í™” ============
    socket.emit('admin:join');

    // ============ ìƒíƒœ ì—…ë°ì´íŠ¸ ============
    socket.on('state:update', (state) => {
      currentState = state;
      updateUI(state);
    });

    socket.on('admin:evaluators', (evaluators) => {
      renderEvaluators(evaluators);
    });

    socket.on('evaluation:allComplete', () => {
      showNotification('ëª¨ë“  í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
    });

    // ============ UI ì—…ë°ì´íŠ¸ ============
    function updateUI(state) {
      document.getElementById('connected-count').textContent = state.connectedCount;
      document.getElementById('evaluated-count').textContent = state.evaluatedCount;
      document.getElementById('total-evaluators').textContent = state.totalEvaluators;
      document.getElementById('evaluator-count-input').value = state.totalEvaluators;

      // Phase í‘œì‹œ
      const badge = document.getElementById('phase-badge');
      badge.className = 'phase-badge';
      switch(state.phase) {
        case 'waiting':
          badge.textContent = 'ëŒ€ê¸° ì¤‘';
          badge.classList.add('phase-waiting');
          break;
        case 'evaluating':
          badge.textContent = 'í‰ê°€ ì§„í–‰ ì¤‘';
          badge.classList.add('phase-evaluating');
          break;
        case 'results':
          badge.textContent = 'ì§‘ê³„ ì™„ë£Œ';
          badge.classList.add('phase-results');
          break;
        case 'presenting':
          badge.textContent = 'ê²°ê³¼ ë°œí‘œ ì¤‘';
          badge.classList.add('phase-presenting');
          break;
      }

      // ë²„íŠ¼ ìƒíƒœ
      document.getElementById('start-btn').style.display = state.phase === 'waiting' ? 'inline-flex' : 'none';
      document.getElementById('force-close-btn').style.display = state.phase === 'evaluating' ? 'inline-flex' : 'none';
      document.getElementById('start-presentation-btn').style.display = state.phase === 'results' ? 'inline-flex' : 'none';

      // ë°œí‘œ ì»¨íŠ¸ë¡¤
      document.getElementById('presentation-card').style.display = state.phase === 'presenting' ? 'block' : 'none';

      if (state.phase === 'presenting') {
        updatePresentationStep(state.presentationStep);
      }

      // íŒ€ ì„¤ì • ë Œë”ë§
      renderTeamsConfig(state.teams);

      // ê²°ê³¼ í‘œì‹œ
      if (state.phase === 'results' || state.phase === 'presenting') {
        document.getElementById('results-card').style.display = 'block';
        renderResults(state.teams);
      }
    }

    function renderEvaluators(evaluators) {
      const list = document.getElementById('evaluator-list');
      if (evaluators.length === 0) {
        list.innerHTML = '<div style="text-align: center; color: #888; padding: 40px;">ì•„ì§ ì ‘ì†í•œ í‰ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }

      list.innerHTML = evaluators.map(e => {
        let statusClass = 'disconnected';
        let statusText = 'ì˜¤í”„ë¼ì¸';
        if (e.evaluated) {
          statusClass = 'evaluated';
          statusText = 'í‰ê°€ ì™„ë£Œ';
        } else if (e.connected) {
          statusClass = 'connected';
          statusText = 'ì ‘ì† ì¤‘';
        }

        return `
          <div class="evaluator-item">
            <div class="evaluator-info">
              <div class="evaluator-status ${statusClass}"></div>
              <span class="evaluator-name">${e.name}</span>
            </div>
            <span class="evaluator-badge">${statusText}</span>
          </div>
        `;
      }).join('');
    }

    function renderTeamsConfig(teams) {
      const container = document.getElementById('teams-config');
      container.innerHTML = teams.map(team => `
        <div class="team-config">
          <div class="team-config-header">
            <span class="team-number">${team.name}</span>
            <span class="team-investment">${team.totalInvestment}ì–µì›</span>
          </div>
          <input type="text" class="team-input" id="team-name-${team.id}"
                 value="${team.name}" placeholder="íŒ€ ì´ë¦„">
          <input type="text" class="team-input" id="team-topic-${team.id}"
                 value="${team.topic}" placeholder="ë°œí‘œ ì£¼ì œ">
        </div>
      `).join('');
    }

    function renderResults(teams) {
      const sorted = [...teams].sort((a, b) => b.totalInvestment - a.totalInvestment);
      const list = document.getElementById('results-list');
      list.innerHTML = sorted.map((team, idx) => `
        <div class="result-item">
          <div class="result-rank rank-${idx + 1}">${idx + 1}</div>
          <div class="result-info">
            <div class="result-team">${team.name}</div>
            <div style="font-size: 0.85rem; color: #888;">${team.topic}</div>
          </div>
          <div class="result-amount">${team.totalInvestment}ì–µì›</div>
        </div>
      `).join('');
    }

    function updatePresentationStep(step) {
      // ìŠ¤í… ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
      for (let i = 1; i <= 7; i++) {
        const el = document.getElementById(`step-${i}`);
        el.classList.remove('active', 'done');
        if (i < step) el.classList.add('done');
        else if (i === step) el.classList.add('active');
      }

      document.getElementById('step-label').textContent = `Step ${step} / 7`;
      document.getElementById('step-description').textContent = stepDescriptions[step];
      document.getElementById('next-step-btn').disabled = step >= 7;
    }

    // ============ ì•¡ì…˜ ============
    function startEvaluation() {
      if (currentState.connectedCount === 0) {
        alert('ì ‘ì†í•œ í‰ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      socket.emit('admin:startEvaluation');
      showNotification('í‰ê°€ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤');
    }

    function forceClose() {
      if (confirm('í‰ê°€ë¥¼ ê°•ì œ ë§ˆê°í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì•„ì§ ì œì¶œí•˜ì§€ ì•Šì€ í‰ê°€ìì˜ í‰ê°€ëŠ” ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')) {
        socket.emit('admin:forceClose');
        showNotification('í‰ê°€ê°€ ê°•ì œ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤');
      }
    }

    function startPresentation() {
      socket.emit('admin:startPresentation');
      showNotification('ê²°ê³¼ ë°œí‘œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤');
    }

    function nextStep() {
      socket.emit('admin:nextStep');
    }

    function setEvaluatorCount(count) {
      socket.emit('admin:setEvaluatorCount', parseInt(count));
      showNotification(`í‰ê°€ì ìˆ˜ê°€ ${count}ëª…ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤`);
    }

    function updateTeams() {
      if (!currentState) return;
      currentState.teams.forEach(team => {
        const name = document.getElementById(`team-name-${team.id}`).value;
        const topic = document.getElementById(`team-topic-${team.id}`).value;
        socket.emit('admin:updateTeam', { teamId: team.id, name, topic });
      });
      showNotification('íŒ€ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
    }

    function resetSystem() {
      if (confirm('ì‹œìŠ¤í…œì„ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.')) {
        socket.emit('admin:reset');
        showNotification('ì‹œìŠ¤í…œì´ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤');
      }
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }

    // ============ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ============
    document.addEventListener('keydown', (e) => {
      if (currentState?.phase === 'presenting') {
        if (e.key === ' ' || e.key === 'Enter' || e.key === 'ArrowRight') {
          e.preventDefault();
          nextStep();
        }
      }
    });
  </script>
</body>
</html>
